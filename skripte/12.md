# Korišćenje SonarCube za Code Coverage
Sadržaj:
* [Uvod](#uvod)
   * [Šta je SonarQube?](#šta-je-sonarqube)
   * [Šta je pokrivenost koda (CodeCoverage)?](#šta-je-pokrivenost-koda-codecoverage)
* [Instalacija i konfiguracija](#instalacija-i-konfiguracija)
  * [Instalacija Docker-a](#instalacija-docker-a)
  * [Preuzimanje SonarQube Docker Image-a](#preuzimanje-sonarqube-docker-image-a)
  * [Pokretanje SonarQube-a](#pokretanje-sonarqube-a)
  * [Pristup SonarQube-u](#pristup-sonarqube-u)
  * [Preuzimanje C# i Angular Projekat](#preuzimanje-c-i-angular-projekat)
  * [Instalacija SonarScanner-a za C#](#instalacija-sonarscanner-a-za-c)
  * [Kreiranje Projekta u SonarQube-u](#kreiranje-projekta-u-sonarqube-u)
  * [Primena SonarScanner-a na Projekat](#primena-sonarscanner-a-na-projekat)
* [Analiza pokrivenosti koda (CodeCoverage)](#analiza-pokrivenosti-koda-codecoverage)
  * [Izvođenje CodeCoverage analize](#izvođenje-codecoverage-analize)
  * [Korišćenje alata za generisanje CodeCoverage izveštaja](#korišćenje-alata-za-generisanje-codecoverage-izveštaja)
    * [Jacoco](#jacoco)
    * [Istanbul](#istanbul)
    * [OpenCover](#opencover)
  * [Importovanje CodeCoverage izveštaja u SonarQube](#importovanje-codecoverage-izveštaja-u-sonarqube)
  * [Pregledanje CodeCoverage metrika](#pregledanje-codecoverage-metrika)
* [Primena u CI/CD procesima](#primena-u-cicd-procesima)
* [Tumačenje rezultata](#tumačenje-rezultata)
  * [Kako se izračunava pokrivenost koda (CodeCoverage) i razumevanje različitih metrika?](#kako-se-izračunava-pokrivenost-koda-codecoverage-i-razumevanje-različitih-metrika)

## Uvod
### Šta je SonarQube?
SonarQube je automatski alat za pregled koda kojim se samostalno upravlja i koji pomaže u isporučivanju čistog koda. Integrira se u postojeće tokove rada kako bi otkrio probleme u kodu i omogućio kontinuirane provere. SonarQube analizira više od 30 različitih programskih jezika i integrira se u pipeline za kontinuiranu integraciju (CI) na DevOps platformama, osiguravajući da kod ispunjava visoke standarde kvaliteta.

Glavne karakteristike SonarQube-a:

* Statička analiza koda: SonarQube omogućava automatsku analizu koda bez izvršavanja, kako bi se identifikovale potencijalne greške, sigurnosne ranjivosti i druge probleme u kodu.
* Praćenje tehničkog duga: Alat pomaže u praćenju tehničkog duga, ukazujući na oblasti koda koje treba unaprediti kako bi se smanjio dug i održao kvalitet koda na visokom nivou.
* Identifikacija sigurnosnih ranjivosti: SonarQube identifikuje sigurnosne ranjivosti u kodu, omogućavajući timovima da ih adresiraju pre nego što postanu ozbiljan problem.

| ![sonar-development-workflow](https://github.com/user-attachments/assets/ffc5a77c-8bfd-4143-993c-8f1ed14de30f) | 
|:--:| 
| *Izvor: [docs.sonarsource.com](https://docs.sonarsource.com/sonarqube/latest/)* |

### Šta je pokrivenost koda (CodeCoverage)?
Pokrivenost koda (Code Coverage) je metrika razvoja softvera koja se koristi za merenje obima u kom se softverski kod izvršava tokom testiranja. Pokrivenost je kvantitativna mera koja ukazuje na procenat linija koda, grana, iskaza ili drugih strukturnih elemenata pokrivenih skupom testova. Jednostavnije rečeno, pomaže programerima da shvate koliko njihove baze koda koriste njihovi testovi.

Alati za pokrivenost koda(Code Coverage)  obično izražavaju metriku u procentima, pokazujući vam procenat uspešno potvrđenih linija koda u vašim procedurama testiranja, pomažući vam da razumete koliko temeljno testirate svoj kod. 

Neki od alata za analizu pokrivenosti koda, su JaCoCo za Java, Istanbul za JavaScript ili OpenCover za C#, automatski izračunavaju metrike i generišu izveštaje koji pomažu programerima da identifikuju neispravan ili netestiran kod. 

*Izvor: [blog.codacy.com](https://blog.codacy.com/what-is-code-coverage)*
## Instalacija i konfiguracija
### Instalacija Docker-a
Pre nego što počnemo sa instalacijom SonarQube-a, potrebno je da instalirati Docker. Može se preuzeti i instalirati sa zvanične [Docker](https://www.docker.com/products/docker-desktop/) stranice.
### Preuzimanje SonarQube Docker Image-a
Nakon instalacije Docker-a, sledeći korak je preuzimanje SonarQube [Docker image-a](https://hub.docker.com/_/sonarqube). Ovo se postiže korišćenjem Docker komande "docker pull". U vašem terminalu ili komandnom promptu pokrenite sledeću komandu:
```bash
   docker pull sonarqube
```
### Pokretanje SonarQube-a
Kada je SonarQube image preuzet, možemo pokrenuti SonarQube server. To se radi pomoću Docker komande "docker run" ili klikom na dugme "Start" u Docker Desktop tabu "Containers". SonarQube se po default-u pokreće na portu "9000".

Terminal:
```bash
docker run -d --name sonarqube -p 9000:9000 sonarqube
```
Docker Desktop:

![image](https://github.com/user-attachments/assets/c4d27521-3f0c-4f0f-ac93-74afbae0c81e)

Ova komanda će pokrenuti SonarQube container u pozadini ("-d" flag) i mapirati port 9000 sa vašeg host sistema na port "9000" unutar container-a.
### Pristup SonarQube-u
Kada se SonarQube uspešno pokrene, možete mu pristupiti putem web browser-a.
```bash
http://localhost:9000
```

![image](https://github.com/user-attachments/assets/ff83a05b-68fc-403c-8cb6-9d6cad238406)

![image](https://github.com/user-attachments/assets/03ba0a3c-7875-4058-8f2b-a227e01d1372)

### Preuzimanje C# i Angular Projekat
Za demonstraciju procesa postavljanja i analize koda pomoću SonarQube-a koristimo projekat sa SI predmeta koji uključuje C# za backend i Angular za frontend. Koraci se mogu primeniti na bilo koji drugi projekat. U ovom primeru, fokusiraćemo se na korišćenje SonarQube-a za analizu C# dela projekta, pokazujući kako se SonarQube integriše u C# okruženje i kako se koristi za poboljšanje kvaliteta koda.

### Instalacija SonarScanner-a za C#
Da bismo koristili SonarQube za analizu C# projekata, potrebno je da instalirate SonarScanner. SonarScanner je alat koji se koristi za pokretanje analize koda i slanje rezultata na SonarQube server.

[SonarScanner](https://docs.sonarsource.com/sonarqube/latest/analyzing-source-code/scanners/sonarscanner-for-dotnet/) za .NET Framework možemo preuzeti sa zvaničnog SonarQube sajta i preuzmemo odgovarajuću verziju SonarScanner-a za našu platformu. Nakon preuzimanja, pratimo uputstva za instalaciju kako bismo alat pripremili za korišćenje u našem C# projektu.

### Kreiranje Projekta u SonarQube-u
Nakon što smo pristupili SonarQube interfejsu, potrebno je da kreirate novi projekat za analizu. Na početnoj stranici SonarQube-a kliknemo na dugme "Create new project".

![image](https://github.com/user-attachments/assets/094d151b-73ba-4b9c-b040-02e3f217da39)

Unesemo naziv našeg projekta i nastavimo sa procesom. 

![image](https://github.com/user-attachments/assets/f320d84d-aa23-4491-8812-0abe204c4b13)
![image](https://github.com/user-attachments/assets/46948a2e-a711-4060-9e32-398f9f491b6c)

Kliknemo na opciju "Locally" i generišemo projektni token.



![image](https://github.com/user-attachments/assets/acdbbd0c-156d-4d74-901d-dd650fd6b5b3)
![image](https://github.com/user-attachments/assets/3cff37f4-f53d-4c71-b795-288a3876efad)

Na kraju, SonarQube će nam dati set komandi koje treba da pokrenemo u terminalu kako bismo analizirali naš C# projekat.

![image](https://github.com/user-attachments/assets/1b31a57e-120d-41c2-baac-c35df037a6d0)

### Primena SonarScanner-a na Projekat
```bash
"SonarScanner installation path"\SonarScanner.MSBuild.exe begin /k:"backAPI" /d:sonar.host.url="http://localhost:9000" /d:sonar.token="sqp_2c7b5abb6f7c8d956663de34db9d67d54860274f"
```

![image](https://github.com/user-attachments/assets/3e31d297-4b03-47bc-b2a6-4b2caffab12f)

```bash
& "C:\Program Files\Microsoft Visual Studio\2022\Community\MSBuild\Current\Bin\MsBuild.exe" C:\syncatech\src\back\backAPI /t:Rebuild
```

![image](https://github.com/user-attachments/assets/1d5912fe-4ff4-456b-978d-64802ba14cf5)
![image](https://github.com/user-attachments/assets/c77c3a00-2e3b-456a-85fd-61ce25866d4c)

```bash
"SonarScanner installation path"\SonarScanner.MSBuild.exe end /d:sonar.token="sqp_2c7b5abb6f7c8d956663de34db9d67d54860274f"
```

![image](https://github.com/user-attachments/assets/9108e8c9-758c-4728-9ab0-313552f68b21)
![image](https://github.com/user-attachments/assets/704696ef-3206-4b62-98ed-57f693400f92)

## Analiza pokrivenosti koda (CodeCoverage)
### Izvođenje CodeCoverage analize
Nakon što pokrenemo navedene komande, SonarQube će automatski analizirati C# projekat i prikazati rezultate na web interfejsu. Možemo pregledati greške, upozorenja, i preporuke za poboljšanje našeg koda direktno u SonarQube interfejsu.
![image](https://github.com/user-attachments/assets/58ced89f-6fd2-4e67-88df-de07632d1787)

### Korišćenje alata za generisanje CodeCoverage izveštaja
Generisanje izveštaja o pokrivenosti koda (Code Coverage) uz pomoć alata kao što su *[JaCoCo](https://github.com/jacoco/jacoco)*, *[Istanbul](https://istanbul.js.org/)* i *[OpenCover](https://github.com/OpenCover/opencover)* je ključno za osiguranje kvaliteta koda. Ovi alati omogućavaju programerima da vide koliko je njihov kod pokriven testovima i identifikuju delove koda koji nisu testirani. 
#### JaCoCo
#### Istanbul
#### OpenCover
### Importovanje CodeCoverage izveštaja u SonarQube

### Pregledanje CodeCoverage metrika

## Primena u CI/CD procesima

## Tumačenje rezultata

### Kako se izračunava pokrivenost koda (CodeCoverage) i razumevanje različitih metrika?
Alati za pokrivanje koda (Code Coverage)  će koristiti jedan ili više kriterijuma da bi utvrdili kako je vaš kod uvežbavan ili ne tokom izvršavanja vašeg testnog paketa. Uobičajeni pokazatelji koje možete da vidite da se pominju u vašim izveštajima o pokrivenosti uključuju: 
* Pokrivenost funkcije(Function Coverage): koliko je definisanih funkcija pozvano. 
* Pokrivenost iskaza(Statement Coverage): koliko je iskaza u programu izvršeno. 
* Pokrivenost grana(Branch Coverage): koliko je grana kontrolnih struktura (ako su izjave na primer) izvršene. 
* Pokrivenost uslova(Condition Coverage): koliko je logičkih podizraza testirano na tačnu i lažnu vrednost. 
* Pokrivenost linija(Line coverage): koliko je linija izvornog koda testirano. 

Ove metrike su obično predstavljene kao broj stvarno testiranih stavki, stavki pronađenih u vašem kodu i procenat pokrivenosti (testirane stavke / pronađene stavke). 
