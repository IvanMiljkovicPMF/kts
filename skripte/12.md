# Korišćenje SonarCube za Code Coverage
Sadržaj:
* [Uvod](#uvod)
   * [Šta je SonarQube?](#šta-je-sonarqube)
   * [Šta je pokrivenost koda (Code Coverage)?](#šta-je-pokrivenost-koda-code-coverage)
   * [Zašto je pokrivenost koda (Code Coverage) važna?](#zašto-je-pokrivenost-koda-code-coverage-važna)
* [Instalacija i konfiguracija](#instalacija-i-konfiguracija)
  * [Instalacija Docker-a](#instalacija-docker-a)
  * [Preuzimanje SonarQube Docker Image-a](#preuzimanje-sonarqube-docker-image-a)
  * [Pokretanje SonarQube-a](#pokretanje-sonarqube-a)
  * [Pristup SonarQube-u](#pristup-sonarqube-u)
  * [Preuzimanje C# i Angular Projekat](#preuzimanje-c-i-angular-projekat)
  * [Instalacija SonarScanner-a za C#](#instalacija-sonarscanner-a-za-c)
  * [Kreiranje Projekta u SonarQube-u](#kreiranje-projekta-u-sonarqube-u)
  * [Primena SonarScanner-a na C# Backend Projekat](#primena-sonarscanner-a-na-c-backend-projekat)
* [Analiza pokrivenosti koda (Code Coverage)](#analiza-pokrivenosti-koda-code-coverage)
  * [Analiza Kvaliteta Koda Projekta](#analiza-kvaliteta-koda-projekta)
    * [Overview (Pregled)](#overview-pregled)
    * [Issues (Problemi)](#issues-problemi)
    * [Security Hotspots (Sigurnosne Tačke)](#security-hotspots-sigurnosne-tačke)
    * [Measures (Metrike)](#measures-metrike)
    * [Code (Kod)](#code-kod)
    * [Activity (Aktivnost)](#activity-aktivnost)
  * [Korišćenje alata za generisanje Code Coverage izveštaja](#korišćenje-alata-za-generisanje-code-coverage-izveštaja)
  * [Importovanje Code Coverage izveštaja u SonarQube](#importovanje-code-coverage-izveštaja-u-sonarqube)
  * [Pregledanje Code Coverage metrika](#pregledanje-code-coverage-metrika)
* [Tumačenje rezultata](#tumačenje-rezultata)
* [Kako se izračunava pokrivenost koda (Code Coverage) i razumevanje različitih metrika?](#kako-se-izračunava-pokrivenost-koda-code-coverage-i-razumevanje-različitih-metrika)
* [Primena SonarQube-a u CI/CD procesima](#primena-sonarqube-a-u-cicd-procesima)
  * [GitLab CI/CD](#gitlab-cicd)
* [Prednosti korišćenja SonarQube-a za analizu pokrivenosti koda (Code Coverage)](#prednosti-korišćenja-sonarqube-a-za-analizu-pokrivenosti-koda-code-coverage)

## Uvod
### Šta je SonarQube?
SonarQube je automatski alat za pregled koda kojim se samostalno upravlja i koji pomaže u isporučivanju čistog koda. Integrira se u postojeće tokove rada kako bi otkrio probleme u kodu i omogućio kontinuirane provere. SonarQube analizira više od 30 različitih programskih jezika i integrira se u pipeline za kontinuiranu integraciju (CI) na DevOps platformama, osiguravajući da kod ispunjava visoke standarde kvaliteta.

Glavne karakteristike SonarQube-a:

* Statička analiza koda: SonarQube omogućava automatsku analizu koda bez izvršavanja, kako bi se identifikovale potencijalne greške, sigurnosne ranjivosti i druge probleme u kodu.
* Praćenje tehničkog duga: Alat pomaže u praćenju tehničkog duga, ukazujući na oblasti koda koje treba unaprediti kako bi se smanjio dug i održao kvalitet koda na visokom nivou.
* Identifikacija sigurnosnih ranjivosti: SonarQube identifikuje sigurnosne ranjivosti u kodu, omogućavajući timovima da ih adresiraju pre nego što postanu ozbiljan problem.

| ![sonar-development-workflow](https://github.com/user-attachments/assets/ffc5a77c-8bfd-4143-993c-8f1ed14de30f) | 
|:--:| 
| *Izvor: [docs.sonarsource.com](https://docs.sonarsource.com/sonarqube/latest/)* |

### Šta je pokrivenost koda (Code Coverage)?
Pokrivenost koda (Code Coverage) je metrika razvoja softvera koja se koristi za merenje obima u kom se softverski kod izvršava tokom testiranja. Pokrivenost je kvantitativna mera koja ukazuje na procenat linija koda, grana, iskaza ili drugih strukturnih elemenata pokrivenih skupom testova. Jednostavnije rečeno, pomaže programerima da shvate koliko njihove baze koda koriste njihovi testovi.

Alati za pokrivenost koda(Code Coverage)  obično izražavaju metriku u procentima, pokazujući vam procenat uspešno potvrđenih linija koda u vašim procedurama testiranja, pomažući vam da razumete koliko temeljno testirate svoj kod. 

Tipične metrike pokrivenosti koda uključuju:

- **Ukupna pokrivenost(Overall Coverage)**: Procenat ukupnog koda koji je izvršen testovima.
- **Pokrivenost linija(Line Coverage)**: Procenat linija koda koji su izvršeni testovima.
- **Pokrivenost grana(Branch Coverage)**: Procenat grana kontrolnog toka (if izjave, petlje itd.) koji su izvršeni testovima.

*Izvor: [blog.codacy.com](https://blog.codacy.com/what-is-code-coverage), [docs.source.com](https://docs.sonarsource.com/sonarqube/latest/analyzing-source-code/test-coverage/overview/)*

### Zašto je pokrivenost koda (Code Coverage) važna?

Važnost pokrivenosti koda leži u njenoj sposobnosti da pruži uvid u kvalitet i efikasnost testnog skupa. Metrike pokrivenosti koda mogu pomoći vašem timu u:

- **Identifikovanju nepokrivenog koda** koji nije testiran i može sadržati greške ili potencijalne probleme koje testni skup nije obradio.

- **Poboljšanju održavanja koda ili aktivnosti refaktorisanja.** Kada se promene unesu u kod, izveštaji o pokrivenosti koda mogu pomoći da se osigura da bilo kakve izmene ne uvedu nenamerno nove probleme.

- **Povećanju efikasnosti testiranja** otkrivanjem da li testovi obuhvataju sve delove koda ili se određeni putevi u kodu zanemaruju.

- **Identifikovanju nepotrebnih testova** i njihovom eliminacijom kako bi se ubrzalo testiranje i olakšao kod.

Važno je napomenuti da, iako je pokrivenost koda vredna metrika, postizanje 100% pokrivenosti ne garantuje aplikaciju bez grešaka. To je samo jedan od mnogih alata i praksi u alatima developera za osiguravanje kvaliteta softvera i koda. Naglasak treba da bude na smislenim testovima koji pokrivaju različite scenarije, uključujući rubne slučajeve i potencijalne greške.

Neki od alata za analizu pokrivenosti koda, su JaCoCo za Java, Istanbul za JavaScript ili OpenCover za C#, automatski izračunavaju metrike i generišu izveštaje koji pomažu programerima da identifikuju neispravan ili netestiran kod. 

*Izvor: [blog.codacy.com](https://blog.codacy.com/what-is-code-coverage)*

## Instalacija i konfiguracija
### Instalacija Docker-a
Pre nego što počnemo sa instalacijom SonarQube-a, potrebno je da instalirati Docker. Može se preuzeti i instalirati sa zvanične [Docker](https://www.docker.com/products/docker-desktop/) stranice.
### Preuzimanje SonarQube Docker Image-a
Nakon instalacije Docker-a, sledeći korak je preuzimanje SonarQube [Docker image-a](https://hub.docker.com/_/sonarqube). Ovo se postiže korišćenjem Docker komande "docker pull". U vašem terminalu ili komandnom promptu pokrenite sledeću komandu:
```bash
   docker pull sonarqube
```
### Pokretanje SonarQube-a
Kada je SonarQube image preuzet, možemo pokrenuti SonarQube server. To se radi pomoću Docker komande "docker run" ili klikom na dugme "Start" u Docker Desktop tabu "Containers". SonarQube se po default-u pokreće na portu "9000".

Terminal:
```bash
docker run -d --name sonarqube -p 9000:9000 sonarqube
```
Docker Desktop:

![image](https://github.com/user-attachments/assets/c4d27521-3f0c-4f0f-ac93-74afbae0c81e)

Ova komanda će pokrenuti SonarQube container u pozadini ("-d" flag) i mapirati port 9000 sa vašeg host sistema na port "9000" unutar container-a.
### Pristup SonarQube-u
Kada se SonarQube uspešno pokrene, možete mu pristupiti putem web browser-a.
```bash
http://localhost:9000
```

![image](https://github.com/user-attachments/assets/ff83a05b-68fc-403c-8cb6-9d6cad238406)

![image](https://github.com/user-attachments/assets/03ba0a3c-7875-4058-8f2b-a227e01d1372)

### Preuzimanje C# i Angular Projekat
Za demonstraciju procesa postavljanja i analize koda pomoću SonarQube-a koristimo projekat sa SI predmeta koji uključuje C# za backend i Angular za frontend. Koraci se mogu primeniti na bilo koji drugi projekat. U ovom primeru, fokusiraćemo se na korišćenje SonarQube-a za analizu C# dela projekta, pokazujući kako se SonarQube integriše u C# okruženje i kako se koristi za poboljšanje kvaliteta koda.

### Instalacija SonarScanner-a za C#
Da bismo koristili SonarQube za analizu C# projekata, potrebno je da instalirate SonarScanner. SonarScanner je alat koji se koristi za pokretanje analize koda i slanje rezultata na SonarQube server.

[SonarScanner](https://docs.sonarsource.com/sonarqube/latest/analyzing-source-code/scanners/sonarscanner-for-dotnet/) za .NET Framework možemo preuzeti sa zvaničnog SonarQube sajta i preuzmemo odgovarajuću verziju SonarScanner-a za našu platformu. Nakon preuzimanja, pratimo uputstva za instalaciju kako bismo alat pripremili za korišćenje u našem C# projektu.

### Kreiranje Projekta u SonarQube-u
Nakon što smo pristupili SonarQube interfejsu, potrebno je da kreirate novi projekat za analizu. Na početnoj stranici SonarQube-a kliknemo na dugme "Create Project".

![image](https://github.com/user-attachments/assets/094d151b-73ba-4b9c-b040-02e3f217da39)

Unesemo naziv našeg projekta i nastavimo sa procesom. 

![image](https://github.com/user-attachments/assets/f320d84d-aa23-4491-8812-0abe204c4b13)
![image](https://github.com/user-attachments/assets/46948a2e-a711-4060-9e32-398f9f491b6c)

Kliknemo na opciju "Locally" i generišemo projektni token.

![image](https://github.com/user-attachments/assets/acdbbd0c-156d-4d74-901d-dd650fd6b5b3)
![image](https://github.com/user-attachments/assets/3cff37f4-f53d-4c71-b795-288a3876efad)

Na kraju, SonarQube će nam dati set komandi koje treba da pokrenemo u terminalu kako bismo analizirali naš C# projekat.

![image](https://github.com/user-attachments/assets/1b31a57e-120d-41c2-baac-c35df037a6d0)

### Primena SonarScanner-a na C# Backend Projekat
1. Pokretanje SonarScanner-a za početak analize:
```bash
"SonarScanner installation path"\SonarScanner.MSBuild.exe begin /k:"backAPI" /d:sonar.host.url="http://localhost:9000" /d:sonar.token="sqp_2c7b5abb6f7c8d956663de34db9d67d54860274f"
```
* SonarScanner.MSBuild.exe begin: Ova komanda inicijalizuje analizu koda i šalje podatke o konfiguraciji SonarQube-u.
* /k:"backAPI": Specifikuje ključ projekta (project key) koji je jedinstven identifikator za naš projekat u SonarQube-u.
* /d:sonar.host.url="http://localhost:9000": Definiše URL SonarQube servera na kojem će se slati podaci.
* /d:sonar.token="sqp_2c7b5abb6f7c8d956663de34db9d67d54860274f": Koristi token za autentifikaciju prema SonarQube serveru.

![image](https://github.com/user-attachments/assets/3e31d297-4b03-47bc-b2a6-4b2caffab12f)

2. Kompajliranje projekta koristeći MSBuild:
```bash
& "C:\Program Files\Microsoft Visual Studio\2022\Community\MSBuild\Current\Bin\MsBuild.exe" C:\syncatech\src\back\backAPI /t:Rebuild
```
* MsBuild.exe: Alat za gradnju i kompajliranje C# projekta.
* C:\syncatech\src\back\backAPI: Putanja do izvornog koda našeg projekta.
* /t:Rebuild: Komanda za ponovno gradnju (kompilaciju) projekta. Ovo omogućava SonarScanner-u da analizira kod tokom procesa gradnje.

![image](https://github.com/user-attachments/assets/1d5912fe-4ff4-456b-978d-64802ba14cf5)
![image](https://github.com/user-attachments/assets/c77c3a00-2e3b-456a-85fd-61ce25866d4c)

3. Završavanje SonarScanner analize:
```bash
"SonarScanner installation path"\SonarScanner.MSBuild.exe end /d:sonar.token="sqp_2c7b5abb6f7c8d956663de34db9d67d54860274f"
```
* SonarScanner.MSBuild.exe end: Ova komanda završava analizu i šalje sve prikupljene podatke SonarQube serveru.
* /d:sonar.token="sqp_2c7b5abb6f7c8d956663de34db9d67d54860274f": Koristi token za autentifikaciju prema SonarQube serveru, obezbeđujući da se podaci šalju ispravno.
  
![image](https://github.com/user-attachments/assets/9108e8c9-758c-4728-9ab0-313552f68b21)
![image](https://github.com/user-attachments/assets/704696ef-3206-4b62-98ed-57f693400f92)

## Analiza pokrivenosti koda (Code Coverage)
### Analiza Kvaliteta Koda Projekta
Nakon što pokrenemo navedene komande, SonarQube će automatski analizirati C# projekat i prikazati rezultate na web interfejsu. U SonarQube-u, različiti tabovi na stranici za pregled analize koda pružaju različite vrste informacija o kvalitetu i stanju vašeg koda.

#### Overview (Pregled)
![image](https://github.com/user-attachments/assets/58ced89f-6fd2-4e67-88df-de07632d1787)
**Overview (Pregled)** sadrži Quality Gate Status koji prikazuje trenutni status quality gate-a, koji je skup uslova koje kod mora da zadovolji da bi bio prihvaćen. Ovo uključuje kriterijume kao što su maksimalan broj grešaka ili minimalno 80% pokrivenosti koda. Status quality gate-a pomaže u oceni da li je kod dovoljno kvalitetan za prelazak u sledeću fazu razvoja ili produkcije.

Takođe prikazuje neke kategorijske metrike koda:
- **Security (Bezbednost):** Pruža informacije o sigurnosnim ranjivostima i pretnjama u kodu.
- **Reliability (Pouzdanost):** Prikazuje podatke o pouzdanosti koda, uključujući broj grešaka i njihove posledice.
- **Accepted Issues (Prihvaćeni Problemi):** Ovaj deo pokazuje broj problema koji su prihvaćeni kao deo trenutnog stanja projekta, što           može uključivati i one koje su možda planirane za rešavanje u budućnosti.
- **Coverage (Pokrivenost):** Prikazuje procentualni udeo koda koji je pokriven testovima, ako je uključena pokrivenost testovima.
- **Duplications (Duplikati):** Informacije o duplim delovima koda koji se mogu optimizovati kako bi se poboljšao kvalitet i održivost.
- **Security Hotspots (Sigurnosne Tačke):** Prikazuje delove koda koji su označeni kao sigurnosne tačke i koji zahtevaju dodatnu pažnju          ili reviziju.

*Izvor: [docs.sonarsource.com](https://docs.sonarsource.com/sonarqube/latest/user-guide/quality-gates/)*
  
#### Issues (Problemi)
![image](https://github.com/user-attachments/assets/218e0f88-d8a3-4f52-bc50-3078076fb9a6)
**Issues (Problemi)** u SonarQube-u predstavljaju nedostatke u kodu koji sprečavaju da kod bude označen kao "Clean Code." Svaki problem je rezultat kršenja pravila specifičnih za jezik programiranja i utiče na jednu ili više kvaliteta softvera sa različitim nivoima ozbiljnosti.
**Issues (Problemi)** u SonarQube-u predstavljaju nedostatke u kodu koji sprečavaju da kod bude označen kao "Clean Code." Svaki problem je rezultat kršenja pravila specifičnih za jezik programiranja i utiče na jednu ili više kvaliteta softvera sa različitim nivoima ozbiljnosti.

Šta **Issues** pruža:
- **Dodeljivanje:** Novi problemi se automatski dodeljuju poslednjem autoru koda i mogu se ponovo dodeliti.
- **Kontekst:** Prikazuje gde se problem nalazi u kodu, uključujući primarne i sekundarne lokacije, kao i puteve izvršavanja.
- **Status:** Prikazuje status problema koji se može promeniti tokom njegovog životnog ciklusa (npr. prihvaćen za kasnije rešavanje,             označen kao lažni pozitivan).
- **Tagovanje i Komentarisanje:** Omogućava dodavanje oznaka i komentara na probleme radi lakšeg praćenja i komunikacije.

*Izvor: [docs.sonarsource.com](https://docs.sonarsource.com/sonarqube/latest/user-guide/issues/introduction/)*

#### Security Hotspots (Sigurnosne Tačke)
![image](https://github.com/user-attachments/assets/107f5638-14d5-4bcb-a4e9-365f42f292bd)
**Security Hotspots (Sigurnosne Tačke)** je deo koda označen kao potencijalno osetljiv. Razvojni programer treba da pregleda ovaj kod da bi procenio da li predstavlja sigurnosni rizik i da li je potrebna neka korekcija. Za razliku od ranjivosti koje su trenutni problemi koji zahtevaju popravku, vruće tačke samo označavaju oblasti zabrinutosti. Odluka o ispravci zavisi od pregleda.

Važnost sigurnosnih vrućih tačaka

- **Razumevanje rizika**: Pomaže u razumevanju potencijalnih sigurnosnih rizika i njihovog uticaja.
- **Identifikacija zaštita**: Pregledanje vrućih tačaka pomaže u prepoznavanju i primeni odgovarajućih sigurnosnih mera.
- **Procena uticaja**: Pomaže u određivanju kako primeniti sigurnosne ispravke na osnovu njihovog uticaja na aplikaciju.

Životni ciklus i statusi

- **Za pregled**: Nove vruće tačke koje treba proveriti.
- **Potvrđeno**: Pregledano od strane programera; čekanje na rešavanje.
- **Ispravljeno**: Pregledano i rešeno primenom popravke.
- **Sigurno**: Pregledano i određeno da je sigurno bez potrebnih promena.

Tok rada za pregled vrućih tačaka

- **Procena rizika**: Razumeti zašto je vruća tačka označena.
- **Određivanje potrebe za ispravkom**: Odlučiti da li je potrebna ispravka na osnovu procene rizika.
- **Primena ispravki**: Implementirati preporučene sigurnosne prakse ako je potrebno.

Prioritet pregleda

- **Visok prioritet**: Vruće tačke povezane sa sigurnosnim pravilima velikog uticaja (npr. OWASP Top 10).
- **Srednji/Niski prioritet**: Manje kritične vruće tačke.

Istorija pregleda

- **Praćenje promena**: Pregled statusnih promena i komentara vezanih za vruću tačku.

*Izvor: [docs.sonarsource.com](https://docs.sonarsource.com/sonarqube/latest/user-guide/security-hotspots/)*
  
#### Measures (Metrike)
![image](https://github.com/user-attachments/assets/beb0e932-aa80-4825-b0a7-0407c139bb38)
Analizatori jezika izračunavaju različite metrike koda koje će se koristiti za procenu kvaliteta koda:

- **Metrike koda** koriste se u pravilima za podizanje problema, na primer, kada se dostigne određeni nivo složenosti funkcije u kodu.
- **Metrike koda** koriste se u definiciji kvalitativnih vrata (quality gate). Na primer, možete postaviti uslov na ukupni broj prijavljenih     problema u kodu.

Možemo koristiti različite alate u SonarQube korisničkom interfejsu za praćenje i upoređivanje metrika koda našeg projekta ili portfolija.      Takođe, možemo preuzeti vrednosti metrika putem SonarQube Web API-a u slučaju da koristite spoljne sisteme za praćenje. Za metrike koda         korišćene u SonarQube rešenju po kategorijama možemo pogledati [dokumentaciju](https://docs.sonarsource.com/sonarqube/latest/user-guide/code-metrics/metrics-definition/). Detaljnije praćenje metrika koda našeg projekta možemo pogledati [dokumentaciju](https://docs.sonarsource.com/sonarqube/latest/user-guide/code-metrics/monitoring-project-metrics/).

*Izvor: [docs.sonarsource.com](https://docs.sonarsource.com/sonarqube/latest/user-guide/code-metrics/introduction/)*

#### Code (Kod)
![image](https://github.com/user-attachments/assets/1d2202b8-79ff-4327-b230-ef9ed72fe213)
![image](https://github.com/user-attachments/assets/97c6b799-1683-436f-865b-02e60dafdf52)
![image](https://github.com/user-attachments/assets/603c7522-53f5-421e-9798-2273a3a62164)

Pregled koda projekta.
#### Activity (Aktivnost)
![image](https://github.com/user-attachments/assets/2edecc33-a4df-4a05-b265-1be22d46a667)
Stranica Aktivnost pruža korisnicima mogućnost da prate evoluciju mera projekta i aplikacije tokom vremena.

Grafikoni na stranici Aktivnost pomažu korisnicima da razumeju evoluciju do tri mere po njihovom izboru u odnosu jedna na drugu. Kada pređu mišem preko grafikona, prikazuju se vrednosti mera i događaji povezani sa određenim analizama.

Event (Događaji):

Naredna tabela grupiše događaje koje možemo pronaći na stranici Activity (Aktivnost):

| Event | Description | 
|----------|----------|
| Definition change (Promena definicije) | Definicija aplikacije je promenjena. |
| Issue detection (Detekcija problema) | Analizator korišćen u projektu je ažuriran.|
| Profile (Profil) | Kvalitetni profil korišćen za analizu projekta je promenjen. Ili je profil izmenjen, ili je korišćen drugi profil za analizu. Takođe prikazuje detalje o ažuriranjima pravila. |
| Quality Gate (Kvalitetna kapija) | Status kvalitetne kapije je promenjen. |
| SonarQube version upgrade (Nadogradnja SonarQube verzije) | Verzija SonarQube-a je ažurirana. Pojavljuje se nakon prve analize nakon nadogradnje. |
| Version (Verzija) | Verzija projekta je promenjena. |
| Other (Drugo) | Događaj je ručno kreiran na snimku. Pogledajte Upravljanje istorijom za više informacija. |

*Izvor: [docs.sonarsource.com](https://docs.sonarsource.com/sonarqube/latest/user-guide/activity-and-history/)*

### Korišćenje alata za generisanje Code Coverage izveštaja
Generisanje izveštaja o pokrivenosti koda (Code Coverage) uz pomoć alata je ključno za osiguranje kvaliteta koda. Ovi alati omogućavaju programerima da vide koliko je njihov kod pokriven testovima i identifikuju delove koda koji nisu testirani. U ovom projektu, pošto koristimo C#, koristićemo alat OpenCover za generisanje izveštaja o pokrivenosti koda. OpenCover pruža detaljan uvid u to koji delovi koda su pokriveni testovima, pomažući nam da povećamo pokrivenost i poboljšamo kvalitet koda.

Uputstvo za korišćenje OpenCover alata možemo pogledati [dokumentaciju](https://docs.sonarsource.com/sonarqube/latest/analyzing-source-code/test-coverage/dotnet-test-coverage/), dok se za istraživanje drugih alata za generisanje izveštaja o pokrivenosti koda može pogledati [dokumentacija](https://docs.sonarsource.com/sonarqube/latest/analyzing-source-code/test-coverage/overview/).

### Importovanje Code Coverage izveštaja u SonarQube 
na kraju
https://docs.sonarsource.com/sonarqube/latest/analyzing-source-code/test-coverage/dotnet-test-coverage/
### Pregledanje Code Coverage metrika 
na kraju
## Tumačenje rezultata
Iako je pokrivenost koda važna metrika, fokusiranje na 100% pokrivenosti koda može dovesti do smanjenja koristi. Evo nekoliko smernica za interpretaciju:

- **Visoka pokrivenost ne znači visok kvalitet:** Visoka pokrivenost koda ne garantuje visokokvalitetne testove. Treba se uveriti da testovi pokrivaju rubne slučajeve i potencijalne tačke otkazivanja.
- **Težiti smislenoj pokrivenosti:** Cilj je postići pokrivenost koja pruža poverenje u ponašanje koda, umesto da se fokusira isključivo na postizanje visokog procenta.
- **Uskladiti pokrivenost sa drugim metrikama:** Pokrivenost koda treba razmatrati zajedno sa drugim metrikama kvaliteta koje pruža SonarQube, kao što su kod mirisi, greške i sigurnosni propusti.

*Izvor: [docs.sonarsource.com](https://www.sonarsource.com/blog/sonarqube-code-coverage/)*

## Kako se izračunava pokrivenost koda (Code Coverage) i razumevanje različitih metrika?
Alati za pokrivanje koda (Code Coverage) će koristiti jedan ili više kriterijuma da bi utvrdili kako je vaš kod uvežbavan ili ne tokom izvršavanja vašeg testnog paketa. Uobičajeni pokazatelji koje možete da vidite da se pominju u vašim izveštajima o pokrivenosti uključuju:

* Pokrivenost funkcije(Function Coverage): koliko je definisanih funkcija pozvano. 
* Pokrivenost iskaza(Statement Coverage): koliko je iskaza u programu izvršeno. 
* Pokrivenost grana(Branch Coverage): koliko je grana kontrolnih struktura (ako su izjave na primer) izvršene. 
* Pokrivenost uslova(Condition Coverage): koliko je logičkih podizraza testirano na tačnu i lažnu vrednost. 
* Pokrivenost linija(Line coverage): koliko je linija izvornog koda testirano. 

Ove metrike su obično predstavljene kao broj stvarno testiranih stavki, stavki pronađenih u vašem kodu i procenat pokrivenosti (testirane stavke / pronađene stavke). 

*Izvor: [www.atlassian.com](https://www.atlassian.com/continuous-delivery/software-testing/code-coverage)*

## Primena SonarQube-a u CI/CD procesima
CI/CD označava kontinuiranu integraciju i kontinuiranu isporuku (ili implementaciju) i predstavlja ključne komponente moderne razvojne prakse, posebno u kontekstu DevOps-a i Agile metodologija. 

CI/CD je skup procedura za automatizaciju i pojednostavljenje procesa izgradnje, testiranja i implementacije softverskih aplikacija.

CI/CD osigurava da je kod uvek u stanju spremnom za isporuku i da se nove funkcionalnosti i ispravke grešaka mogu brzo i pouzdano isporučiti u produkciju.

CI/CD pipeline je skup automatizovanih akcija i praksi koje upravljaju načinom na koji se promene u kodu integrišu, testiraju, isporučuju i potencijalno implementiraju tokom procesa razvoja softvera.

CI/CD pipeline je složen proces koji može biti izuzetno koristan za organizacije koje žele da redovno objavljuju nove funkcionalnosti, dok istovremeno smanjuju šanse za neuspehe pri implementaciji.

SonarQube omogućava integraciju sa različitim CI/CD alatima:
- [Jenkins](https://docs.sonarsource.com/sonarqube/latest/analyzing-source-code/ci-integration/jenkins-integration/key-features/)
- [GitHub Actions](https://docs.sonarsource.com/sonarqube/latest/devops-platform-integration/github-integration/introduction/)
- [Bitbucket Pipelines](https://docs.sonarsource.com/sonarqube/latest/devops-platform-integration/bitbucket-integration/bitbucket-cloud-integration/)
- [Azure Pipelines](https://docs.sonarsource.com/sonarqube/latest/analyzing-source-code/scanners/sonarqube-extension-for-azure-devops/)
- [GitLab CI/CD](https://docs.sonarsource.com/sonarqube/latest/devops-platform-integration/gitlab-integration/adding-analysis-to-gitlab-ci-cd/)



Za druge CI/CD alate, može se koristiti parametar sonar.qualitygate.wait=true u konfiguracionom fajlu. Postavljanjem sonar.qualitygate.wait na true, analiza će biti konfigurisana da ponavlja upite ka SonarQube instanci dok status kvalitetnog gate-a ne bude dostupan. Ovo produžava trajanje pipeline-a i uzrokuje da korak analize ne prođe svaki put kada kvalitetni gate ne prođe, čak i ako sama analiza bude uspešna. Ovaj parametar treba koristiti samo ako je to neophodno.

Takođe se može postaviti svojstvo sonar.qualitygate.timeout na broj sekundi koje skener treba da čeka da se izveštaj obradi. Podrazumevani period je 300 sekundi.

*Izvor: [docs.sonarsource.com](https://docs.sonarsource.com/sonarqube/latest/analyzing-source-code/ci-integration/overview/), [docs.sonarsource.com/guide](https://www.sonarsource.com/learn/ci-cd/)*

### GitLab CI/CD
![image](https://github.com/user-attachments/assets/fdd4e8b3-379d-42c1-bdb1-9b3ae51da8c6)

![image](https://github.com/user-attachments/assets/1be5bddd-7e36-41f9-a4b8-8de98dbb8bb7)

![image](https://github.com/user-attachments/assets/c6365913-2058-4e92-83c3-af98b31f00ce)

![image](https://github.com/user-attachments/assets/9f52d52a-2988-43de-8c85-6bc22649d5d9)

![image](https://github.com/user-attachments/assets/0a4c73b5-3981-4e95-be17-51d99c4c60d0)

![image](https://github.com/user-attachments/assets/7c15e08a-fc43-4436-b58e-e8aa4174b26b)

![image](https://github.com/user-attachments/assets/cd3fe172-0342-45db-bce2-78ff19349b41)

![image](https://github.com/user-attachments/assets/c907c4e6-699b-4063-a4b3-1fdd3da85794)
![image](https://github.com/user-attachments/assets/42e77876-bcc3-49c6-8547-4cf20647d19c)
![image](https://github.com/user-attachments/assets/58901933-c266-4607-9800-a79fbb73ac05)
![image](https://github.com/user-attachments/assets/22f93c66-3d25-4e45-832c-4fafb5b4d047)
![image](https://github.com/user-attachments/assets/16a819e5-1e36-4b4a-a22f-cd73a48fa587)
![image](https://github.com/user-attachments/assets/77bd04e5-46e6-4449-9e39-ea58cb954707)
![image](https://github.com/user-attachments/assets/800d0854-ca7b-4850-83b2-9b93f397cb0c)
![image](https://github.com/user-attachments/assets/2df8691a-e013-4b6d-ac78-c99a6cfb3db3)
![image](https://github.com/user-attachments/assets/f2a40937-26e7-48c2-8c7c-ea6b1e6affab)

https://docs.gitlab.com/ee/integration/oauth_provider.html

![image](https://github.com/user-attachments/assets/23d8e4fc-3569-4dd8-8feb-ab7d066571f9)

![image](https://github.com/user-attachments/assets/67549fe5-8259-4665-9e23-3143c41e17e0)








## Prednosti korišćenja SonarQube-a za analizu pokrivenosti koda (Code Coverage)
1. Poboljšana pouzdanost i održivost: Veća pokrivenost koda znači da se veći deo vašeg koda testira kroz različite scenarije, čime se obuhvataju razne putanje kroz koje kod može da prođe. Kada testovi pokrivaju više scenarija i grana koda, veća je verovatnoća da će se pronaći i ispraviti greške pre nego što kod dospe u produkciju. To vodi do stabilnijeg i pouzdanijeg softvera jer se problemi otkrivaju i rešavaju u ranoj fazi, pre nego što postanu ozbiljni i skupi za popravku.

2. Povećano poverenje programera: Značajna prednost pokrivenosti koda (Code Coverage) je poverenje koje pruža prilikom unošenja izmena. Sa visokom pokrivenošću, programeri mogu odmah videti uticaj svojih promena ukoliko dođe do neželjenih efekata, testovi će odmah pasti. Ova trenutna povratna informacija omogućava brzo otkrivanje problema i osigurava stabilnost koda. Dobro testirana baza koda sa visokom pokrivenošću uliva poverenje programerima i smanjuje rizik od unošenja novih grešaka u produkciju.

3. Detaljni izveštaji: SonarQube nudi detaljne izveštaje o pokrivenosti koda, koji jasno ukazuju na delove koda koji nisu testirani. Ovi izveštaji prikazuju pokrivenost po linijama i fajlovima, pružajući precizan uvid u obuhvaćenost testovima. Takvi izveštaji omogućavaju da se zainteresovanim stranama i potencijalnim klijentima pokaže kvalitet i temeljnost procesa testiranja.

4. Akcioni uvidi: Pored samog izveštavanja o procentima pokrivenosti, SonarQube nudi akcione uvide u kontekstu naše baze koda. Naglašava područja s niskom pokrivenošću, pružajući metrike kao što su neproverene linije i uslovi. Pogledati *[dokumentaciju](https://docs.sonarsource.com/sonarqube/latest/user-guide/code-metrics/metrics-definition/#tests)* za sve metrike koje SonarQube izveštava za pokrivenost testova.

    *Izvor: [docs.sonarsource.com](https://www.sonarsource.com/blog/sonarqube-code-coverage/)*
